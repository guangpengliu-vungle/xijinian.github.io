<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.xijinian.top","root":"/","scheme":"Gemini","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":true,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="反射获取类对象Java 中，类信息对应的类就是 java.lang.Class，获取类对象有 3 种方式：①Class.forName(&quot;Hero&quot;)；②Hero.class；③new Hero().getClass()。 注意：接口也有 Class 对象，数组也有，基本类型也有，枚举也有，就是这么出乎意料！ 获取类名称信息123456public String getName">
<meta property="og:type" content="article">
<meta property="og:title" content="反射、注解、代理和类加载机制">
<meta property="og:url" content="https://www.xijinian.top/2019/01/20/%E5%8F%8D%E5%B0%84%E3%80%81%E6%B3%A8%E8%A7%A3%E3%80%81%E4%BB%A3%E7%90%86%E5%92%8C%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/index.html">
<meta property="og:site_name" content="Adventures of xijinian">
<meta property="og:description" content="反射获取类对象Java 中，类信息对应的类就是 java.lang.Class，获取类对象有 3 种方式：①Class.forName(&quot;Hero&quot;)；②Hero.class；③new Hero().getClass()。 注意：接口也有 Class 对象，数组也有，基本类型也有，枚举也有，就是这么出乎意料！ 获取类名称信息123456public String getName">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2020/06/08/tfZhFbOwdiMR2Wc.png">
<meta property="article:published_time" content="2019-01-20T15:23:30.000Z">
<meta property="article:modified_time" content="2020-06-16T15:35:07.000Z">
<meta property="article:author" content="xijinian">
<meta property="article:tag" content="Java 编程的逻辑">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/06/08/tfZhFbOwdiMR2Wc.png">

<link rel="canonical" href="https://www.xijinian.top/2019/01/20/%E5%8F%8D%E5%B0%84%E3%80%81%E6%B3%A8%E8%A7%A3%E3%80%81%E4%BB%A3%E7%90%86%E5%92%8C%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>反射、注解、代理和类加载机制 | Adventures of xijinian</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Adventures of xijinian</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/xijinian" class="github-corner" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.xijinian.top/2019/01/20/%E5%8F%8D%E5%B0%84%E3%80%81%E6%B3%A8%E8%A7%A3%E3%80%81%E4%BB%A3%E7%90%86%E5%92%8C%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="xijinian">
      <meta itemprop="description" content="放轻松，就像在漫游地球～">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Adventures of xijinian">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          反射、注解、代理和类加载机制
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-01-20 23:23:30" itemprop="dateCreated datePublished" datetime="2019-01-20T23:23:30+08:00">2019-01-20</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2019/01/20/%E5%8F%8D%E5%B0%84%E3%80%81%E6%B3%A8%E8%A7%A3%E3%80%81%E4%BB%A3%E7%90%86%E5%92%8C%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/01/20/反射、注解、代理和类加载机制/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="反射"><a href="#反射" class="headerlink" title="反射"></a>反射</h2><h3 id="获取类对象"><a href="#获取类对象" class="headerlink" title="获取类对象"></a>获取类对象</h3><p>Java 中，类信息对应的类就是 <code>java.lang.Class</code>，获取类对象有 3 种方式：①<code>Class.forName(&quot;Hero&quot;)</code>；②<code>Hero.class</code>；③<code>new Hero().getClass()</code>。</p>
<p>注意：接口也有 <code>Class</code> 对象，数组也有，基本类型也有，枚举也有，就是这么出乎意料！</p>
<h3 id="获取类名称信息"><a href="#获取类名称信息" class="headerlink" title="获取类名称信息"></a>获取类名称信息</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// 只用名字就获得这个</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getSimpleName</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// 想要获得包名就用这个</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getCanonicalName</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Package <span class="title">getPackage</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p><img data-src="https://i.loli.net/2020/06/08/tfZhFbOwdiMR2Wc.png" alt=""></p>
<p>数组类型的 <code>getName</code> 返回值，它使用前缀 <code>[</code> 表示数组，有几个 <code>[</code> 表示是几维数组，数组的类型用一个字符表示，<code>I</code> 表示 <code>int</code>，<code>L</code> 表示类或接口，其他类型与字符的对应关系为: <code>boolean</code>(<code>Z</code>), <code>byte</code>(<code>B</code>), <code>char</code>(<code>C</code>), <code>double</code>(<code>D</code>), <code>float</code>(<code>F</code>), <code>long</code>(<code>J</code>), <code>short</code>(<code>S</code>)，对于引用类型的数组，注意最后有一个分号 <code>;</code>。</p>
<h3 id="获取字段信息"><a href="#获取字段信息" class="headerlink" title="获取字段信息"></a>获取字段信息</h3><h4 id="Class-的方法"><a href="#Class-的方法" class="headerlink" title="Class 的方法"></a><code>Class</code> 的方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回所有的 public 字段，包括其父类的，如果没有字段，返回空数组</span></span><br><span class="line"><span class="keyword">public</span> Field[] getFields()</span><br><span class="line"><span class="comment">// 返回本类声明的所有字段，包括非 public 的，但不包括父类的</span></span><br><span class="line"><span class="keyword">public</span> Field[] getDeclaredFields()</span><br><span class="line"><span class="comment">// 返回本类或父类中指定名称的 public 字段，找不到抛出异常 NoSuchFieldException</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Field <span class="title">getField</span><span class="params">(String name)</span></span></span><br><span class="line"><span class="function"><span class="comment">// 返回本类中声明的指定名称的字段，找不到抛出异常 NoSuchFieldException</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Field <span class="title">getDeclaredField</span><span class="params">(String name)</span></span></span><br></pre></td></tr></table></figure>

<h4 id="Field-的方法"><a href="#Field-的方法" class="headerlink" title="Field 的方法"></a><code>Field</code> 的方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取字段的名称</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// 判断当前程序是否有该字段的访问权限</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAccessible</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// flag 设为 true 表示忽略 Java 的访问检查机制，以允许读写非 public 的字段</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAccessible</span><span class="params">(<span class="keyword">boolean</span> flag)</span></span></span><br><span class="line"><span class="function"><span class="comment">// 获取指定对象 obj 中该字段的值</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(Object obj)</span></span></span><br><span class="line"><span class="function"><span class="comment">// 将指定对象 obj 中该字段的值设为 value</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(Object obj, Object value)</span></span></span><br><span class="line"><span class="function"><span class="comment">// 返回字段的修饰符，最终的值可以用 Modifier 类的静态方法进行解读，如 Modifier.toString(mod)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getModifiers</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// 返回字段的类型</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Class&lt;?&gt; <span class="title">getType</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// 以基本类型操作字段</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBoolean</span><span class="params">(Object obj, <span class="keyword">boolean</span> z)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">getBoolean</span><span class="params">(Object obj)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDouble</span><span class="params">(Object obj, <span class="keyword">double</span> d)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getDouble</span><span class="params">(Object obj)</span></span></span><br><span class="line"><span class="function"><span class="comment">// 查询字段的注解信息</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> &lt;T extends Annotation&gt; T <span class="title">getAnnotation</span><span class="params">(Class&lt;T&gt; annotationClass)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Annotation[] <span class="title">getDeclaredAnnotations</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>

<p>在 <code>get/set</code> 方法中，对于静态变量，<code>obj</code> 被忽略，可以为 <code>null</code>，如果字段值为基本类型，<code>get/set</code> 会自动在基本类型与对应的包装类型间进行转换，对于 <code>private</code> 字段，直接调用 <code>get/set</code> 会抛出非法访问异常 <code>IllegalAccessException</code>，应该先调用 <code>setAccessible(true)</code> 以关闭 Java 的检查机制。</p>
<h3 id="获得方法信息"><a href="#获得方法信息" class="headerlink" title="获得方法信息"></a>获得方法信息</h3><h4 id="Class-的方法-1"><a href="#Class-的方法-1" class="headerlink" title="Class 的方法"></a><code>Class</code> 的方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回所有的 public 方法，包括其父类的，如果没有方法，返回空数组</span></span><br><span class="line"><span class="keyword">public</span> Method[] getMethods()</span><br><span class="line"><span class="comment">// 返回本类声明的所有方法，包括非 public 的，但不包括父类的</span></span><br><span class="line"><span class="keyword">public</span> Method[] getDeclaredMethods()</span><br><span class="line"><span class="comment">// 返回本类或父类中指定名称和参数类型的 public 方法，找不到抛出异常 NoSuchMethodException</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Method <span class="title">getMethod</span><span class="params">(String name, Class&lt;?&gt;... parameterTypes)</span></span></span><br><span class="line"><span class="function"><span class="comment">// 返回本类中声明的指定名称和参数类型的方法，找不到抛出异常 NoSuchMethodException</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Method <span class="title">getDeclaredMethod</span><span class="params">(String name, Class&lt;?&gt;... parameterTypes)</span></span></span><br></pre></td></tr></table></figure>

<h4 id="Method-的方法"><a href="#Method-的方法" class="headerlink" title="Method 的方法"></a><code>Method</code> 的方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取方法的名称</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// flag 设为 true 表示忽略 Java 的访问检查机制，以允许调用非 public 的方法</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAccessible</span><span class="params">(<span class="keyword">boolean</span> flag)</span></span></span><br><span class="line"><span class="function"><span class="comment">// 在指定对象 obj 上调用 Method 代表的方法，传递的参数列表为 args</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object obj, Object... args)</span> <span class="keyword">throws</span> ...</span></span><br><span class="line"><span class="function"><span class="comment">// 获取方法的修饰符，返回值可通过 Modifier 类进行解读</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getModifiers</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// 获取方法的参数类型</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Class&lt;?&gt;[] <span class="title">getParameterTypes</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// 获取方法的返回值类型</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Class&lt;?&gt; <span class="title">getReturnType</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// 获取方法声明抛出的异常类型</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Class&lt;?&gt;[] <span class="title">getExceptionTypes</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// 获取注解信息</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Annotation[] <span class="title">getDeclaredAnnotations</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> &lt;T extends Annotation&gt; T <span class="title">getAnnotation</span><span class="params">(Class&lt;T&gt; annotationClass)</span></span></span><br><span class="line"><span class="function"><span class="comment">// 获取方法参数的注解信息</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Annotation[][] <span class="title">getParameterAnnotations</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>

<h3 id="创建对象"><a href="#创建对象" class="headerlink" title="创建对象"></a>创建对象</h3><h4 id="Class-的方法-2"><a href="#Class-的方法-2" class="headerlink" title="Class 的方法"></a><code>Class</code> 的方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 调用类的默认构造方法 (即无参 public 构造方法)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">newInstance</span><span class="params">()</span> <span class="keyword">throws</span> InstantiationException, IllegalAccessException</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 获取所有的 public 构造方法，返回值可能为长度为 0 的空数组</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Constructor&lt;?&gt;[] <span class="title">getConstructors</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// 获取所有的构造方法，包括非 public 的</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Constructor&lt;?&gt;[] <span class="title">getDeclaredConstructors</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// 获取指定参数类型的 public 构造方法，没找到抛出异常 NoSuchMethodException</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Constructor&lt;T&gt; <span class="title">getConstructor</span><span class="params">(Class&lt;?&gt;... parameterTypes)</span></span></span><br><span class="line"><span class="function"><span class="comment">// 获取指定参数类型的构造方法，包括非 public 的，没找到抛出异常 NoSuchMethodException</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Constructor&lt;T&gt; <span class="title">getDeclaredConstructor</span><span class="params">(Class&lt;?&gt;... parameterTypes)</span></span></span><br></pre></td></tr></table></figure>

<h4 id="Constructor-的方法"><a href="#Constructor-的方法" class="headerlink" title="Constructor 的方法"></a><code>Constructor</code> 的方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">newInstance</span><span class="params">(Object ... initargs)</span> <span class="keyword">throws</span> ...</span></span><br></pre></td></tr></table></figure>

<p>例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Constructor&lt;StringBuilder&gt; contructor = StringBuilder.class.getConstructor(new Class[]&#123;int.class&#125;);</span><br><span class="line">StringBuilder sb = contructor.newInstance(<span class="number">100</span>);</span><br></pre></td></tr></table></figure>

<p>其它方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取参数的类型信息</span></span><br><span class="line"><span class="keyword">public</span> Class&lt;?&gt;[] getParameterTypes()</span><br><span class="line"><span class="comment">// 构造方法的修饰符，返回值可通过 Modifier 类进行解读</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getModifiers</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// 构造方法的注解信息</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Annotation[] <span class="title">getDeclaredAnnotations</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> &lt;T extends Annotation&gt; T <span class="title">getAnnotation</span><span class="params">(Class&lt;T&gt; annotationClass)</span></span></span><br><span class="line"><span class="function"><span class="comment">// 构造方法中参数的注解信息</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Annotation[][] <span class="title">getParameterAnnotations</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>

<h3 id="类型检查和转换"><a href="#类型检查和转换" class="headerlink" title="类型检查和转换"></a>类型检查和转换</h3><p><code>Class</code> 的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">boolean</span> <span class="title">isInstance</span><span class="params">(Object obj)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">cast</span><span class="params">(Object obj)</span></span></span><br><span class="line"><span class="function"><span class="comment">// 检查参数类型 cls 能否赋给当前 Class 类型的变量</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">boolean</span> <span class="title">isAssignableFrom</span><span class="params">(Class&lt;?&gt; cls)</span></span>;</span><br></pre></td></tr></table></figure>

<h3 id="获取-Class-的类型信息"><a href="#获取-Class-的类型信息" class="headerlink" title="获取 Class 的类型信息"></a>获取 Class 的类型信息</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 是否是数组</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">boolean</span> <span class="title">isArray</span><span class="params">()</span></span>;  </span><br><span class="line"><span class="comment">// 是否是基本类型</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">boolean</span> <span class="title">isPrimitive</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// 是否是接口</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">boolean</span> <span class="title">isInterface</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// 是否是枚举</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEnum</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// 是否是注解</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAnnotation</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// 是否是匿名内部类</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAnonymousClass</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// 是否是成员类</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isMemberClass</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// 是否是本地类（本地类是指在方法内部定义的非匿名内部类）</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isLocalClass</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>

<h3 id="获取-Class-的声明信息"><a href="#获取-Class-的声明信息" class="headerlink" title="获取 Class 的声明信息"></a>获取 Class 的声明信息</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取修饰符，返回值可通过 Modifier 类进行解读</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">int</span> <span class="title">getModifiers</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// 获取父类，如果为 Object ，父类为 null</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> Class&lt;? <span class="keyword">super</span> T&gt; <span class="title">getSuperclass</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// 对于类，为自己声明实现的所有接口，对于接口，为直接扩展的接口，不包括通过父类间接继承来的</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> Class&lt;?&gt;[] <span class="title">getInterfaces</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// 自己声明的注解</span></span><br><span class="line"><span class="keyword">public</span> Annotation[] getDeclaredAnnotations()</span><br><span class="line"><span class="comment">// 所有的注解，包括继承得到的</span></span><br><span class="line"><span class="keyword">public</span> Annotation[] getAnnotations()</span><br><span class="line"><span class="comment">// 获取或检查指定类型的注解，包括继承得到的</span></span><br><span class="line"><span class="keyword">public</span> &lt;A extends Annotation&gt; <span class="function">A <span class="title">getAnnotation</span><span class="params">(Class&lt;A&gt; annotationClass)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAnnotationPresent</span><span class="params">(Class&lt;? extends Annotation&gt; annotationClass)</span></span></span><br></pre></td></tr></table></figure>

<h3 id="内部类"><a href="#内部类" class="headerlink" title="内部类"></a>内部类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取所有的 public 的内部类和接口，包括从父类继承得到的</span></span><br><span class="line"><span class="keyword">public</span> Class&lt;?&gt;[] getClasses()</span><br><span class="line"><span class="comment">// 获取自己声明的所有的内部类和接口</span></span><br><span class="line"><span class="keyword">public</span> Class&lt;?&gt;[] getDeclaredClasses()</span><br><span class="line"><span class="comment">// 如果当前 Class 为内部类，获取声明该类的最外部的 Class 对象</span></span><br><span class="line"><span class="keyword">public</span> Class&lt;?&gt; getDeclaringClass()</span><br><span class="line"><span class="comment">// 如果当前 Class 为内部类，获取直接包含该类的类</span></span><br><span class="line"><span class="keyword">public</span> Class&lt;?&gt; getEnclosingClass()</span><br><span class="line"><span class="comment">// 如果当前 Class 为本地类或匿名内部类，返回包含它的方法</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Method <span class="title">getEnclosingMethod</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>

<h3 id="类类型的加载"><a href="#类类型的加载" class="headerlink" title="类类型的加载"></a>类类型的加载</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Class&lt;?&gt; forName(String className)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Class&lt;?&gt; forName(String name, <span class="keyword">boolean</span> initialize, ClassLoader loader)</span><br></pre></td></tr></table></figure>

<p>注意：这里 <code>className</code> 与 <code>Class.getName</code> 的返回值是一致的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String name = <span class="string">"[Ljava.lang.String;"</span>;</span><br><span class="line">Class cls = Class.forName(name);</span><br></pre></td></tr></table></figure>

<p>基本类型不支持 <code>forName</code> 方法，迂回办法 — 包装 <code>Class</code> 的 <code>forName</code> 方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Class&lt;?&gt; forName(String className) <span class="keyword">throws</span> ClassNotFoundException&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="string">"int"</span>.equals(className))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">int</span><span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//其他基本类型...</span></span><br><span class="line">    <span class="keyword">return</span> Class.forName(className);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="反射和数组"><a href="#反射和数组" class="headerlink" title="反射和数组"></a>反射和数组</h3><h4 id="Class-的方法-3"><a href="#Class-的方法-3" class="headerlink" title="Class 的方法"></a><code>Class</code> 的方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取子元素的类型</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">native</span> Class&lt;?&gt; getComponentType()</span><br></pre></td></tr></table></figure>

<h4 id="Array-的方法"><a href="#Array-的方法" class="headerlink" title="Array 的方法"></a><code>Array</code> 的方法</h4><blockquote>
<p><code>java.lang.reflect</code> 包中有一个针对数组的专门的类 <code>Array</code>（注意不是 <code>java.util</code> 中的 <code>Arrays</code>)</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建指定元素类型、指定长度的数组</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">newInstance</span><span class="params">(Class&lt;?&gt; componentType, <span class="keyword">int</span> length)</span></span></span><br><span class="line"><span class="function"><span class="comment">// 创建多维数组</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">newInstance</span><span class="params">(Class&lt;?&gt; componentType, <span class="keyword">int</span>... dimensions)</span></span></span><br><span class="line"><span class="function"><span class="comment">// 获取数组 array 指定的索引位置 index 处的值</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> Object <span class="title">get</span><span class="params">(Object array, <span class="keyword">int</span> index)</span></span></span><br><span class="line"><span class="function"><span class="comment">// 修改数组 array 指定的索引位置 index 处的值为 value</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(Object array, <span class="keyword">int</span> index, Object value)</span></span></span><br><span class="line"><span class="function"><span class="comment">// 返回数组的长度</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">int</span> <span class="title">getLength</span><span class="params">(Object array)</span></span></span><br></pre></td></tr></table></figure>

<h3 id="反射和枚举"><a href="#反射和枚举" class="headerlink" title="反射和枚举"></a>反射和枚举</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> T[] getEnumConstants()</span><br></pre></td></tr></table></figure>

<h3 id="反射和泛型"><a href="#反射和泛型" class="headerlink" title="反射和泛型"></a>反射和泛型</h3><p>泛型参数在运行时会被擦除，但借助反射，我们可以得到泛型信息。</p>
<h4 id="Class-的方法-4"><a href="#Class-的方法-4" class="headerlink" title="Class 的方法"></a><code>Class</code> 的方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TypeVariable&lt;Class&lt;T&gt;&gt;[] getTypeParameters()</span><br></pre></td></tr></table></figure>

<h4 id="Field-的方法-1"><a href="#Field-的方法-1" class="headerlink" title="Field 的方法"></a><code>Field</code> 的方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Type <span class="title">getGenericType</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>

<h4 id="Method-的方法-1"><a href="#Method-的方法-1" class="headerlink" title="Method 的方法"></a><code>Method</code> 的方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Type <span class="title">getGenericReturnType</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Type[] <span class="title">getGenericParameterTypes</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Type[] <span class="title">getGenericExceptionTypes</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>

<h4 id="Constructor-的方法-1"><a href="#Constructor-的方法-1" class="headerlink" title="Constructor 的方法"></a><code>Constructor</code> 的方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Type[] getGenericParameterTypes()</span><br></pre></td></tr></table></figure>

<h4 id="Type-接口"><a href="#Type-接口" class="headerlink" title="Type 接口"></a><code>Type</code> 接口</h4><p><code>Type</code> 是一个接口，<code>Class</code> 实现了 <code>Type</code>，<code>Type</code> 的其他子接口还有：</p>
<ul>
<li><code>TypeVariable</code>：类型参数，可以有上界，比如：<code>T extends Number</code></li>
<li><code>ParameterizedType</code>：参数化的类型，有原始类型和具体的类型参数，比如：<code>List&lt;String&gt;</code> </li>
<li><code>WildcardType</code>：通配符类型，比如：<code>?</code>， <code>? extends Number</code>，<code>? super Integer</code></li>
</ul>
<h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericTest</span>&lt;<span class="title">U</span> <span class="keyword">extends</span> <span class="title">Comparable</span>&lt;<span class="title">U</span>&gt;, <span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">        U u;</span><br><span class="line">        V v;</span><br><span class="line">        List&lt;String&gt; list;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> U <span class="title">test</span><span class="params">(List&lt;? extends Number&gt; numbers)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Class&lt;?&gt; cls = GenericTest<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">        <span class="comment">// 类的类型参数</span></span><br><span class="line">        <span class="keyword">for</span> (TypeVariable t : cls.getTypeParameters()) &#123;</span><br><span class="line">            System.out.println(t.getName() + <span class="string">" extends "</span> + Arrays.toString(t.getBounds()));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 字段 - 泛型类型</span></span><br><span class="line">        Field fu = cls.getDeclaredField(<span class="string">"u"</span>);</span><br><span class="line">        System.out.println(fu.getGenericType());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 字段 - 参数化的类型</span></span><br><span class="line">        Field flist = cls.getDeclaredField(<span class="string">"list"</span>);</span><br><span class="line">        Type listType = flist.getGenericType();</span><br><span class="line">        <span class="keyword">if</span> (listType <span class="keyword">instanceof</span> ParameterizedType) &#123;</span><br><span class="line">            ParameterizedType pType = (ParameterizedType) listType;</span><br><span class="line">            System.out.println(<span class="string">"raw type: "</span> + pType.getRawType() + <span class="string">",type arguments:"</span></span><br><span class="line">                    + Arrays.toString(pType.getActualTypeArguments()));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 方法的泛型参数</span></span><br><span class="line">        Method m = cls.getMethod(<span class="string">"test"</span>, <span class="keyword">new</span> Class[] &#123; List<span class="class">.<span class="keyword">class</span> &#125;)</span>;</span><br><span class="line">        <span class="keyword">for</span> (Type t : m.getGenericParameterTypes()) &#123;</span><br><span class="line">            System.out.println(t);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/** out</span></span><br><span class="line"><span class="comment"> * U extends [java.lang.Comparable&lt;U&gt;]</span></span><br><span class="line"><span class="comment"> * V extends [class java.lang.Object]</span></span><br><span class="line"><span class="comment"> * U</span></span><br><span class="line"><span class="comment"> * raw type: interface java.util.List,type arguments:[class java.lang.String]</span></span><br><span class="line"><span class="comment"> * java.util.List&lt;? extends java.lang.Number&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<h2 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h2><h3 id="创建注解"><a href="#创建注解" class="headerlink" title="创建注解"></a>创建注解</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(ElementType.METHOD)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.SOURCE)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Override &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="元注解-Target"><a href="#元注解-Target" class="headerlink" title="元注解 @Target"></a>元注解 <code>@Target</code></h4><p><code>@Target</code> 表示注解的目标，参数 <code>ElementType</code> 是一个枚举，其他可选值有：</p>
<ul>
<li><code>TYPE</code>：表示类、接口（包括注解），或者枚举声明</li>
<li><code>FIELD</code>：字段，包括枚举常量</li>
<li><code>METHOD</code>：方法</li>
<li><code>PARAMETER</code>：方法中的参数</li>
<li><code>CONSTRUCTOR</code>：构造方法</li>
<li><code>LOCAL_VARIABLE</code>：本地变量</li>
<li><code>ANNOTATION_TYPE</code>：注解类型</li>
<li><code>PACKAGE</code>：包</li>
</ul>
<p>目标可以有多个，用 <code>{}</code> 表示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(&#123;TYPE, FIELD, METHOD, PARAMETER, CONSTRUCTOR, LOCAL_VARIABLE&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.SOURCE)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SuppressWarnings &#123;</span><br><span class="line">    String[] value();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果没有声明 <code>@Target</code>，默认为适用于所有类型。</p>
<h4 id="元注解-Retention"><a href="#元注解-Retention" class="headerlink" title="元注解 @Retention"></a>元注解 <code>@Retention</code></h4><p><code>@Retention</code> 表示注解信息保留到什么时候，取值只能有一个，类型为 <code>RetentionPolicy</code>，它是一个枚举，有三个取值：</p>
<ul>
<li><code>SOURCE</code>：只在源代码中保留，编译器将代码编译为字节码文件后就会丢掉</li>
<li><code>CLASS</code>：保留到字节码文件中，但 Java 虚拟机将 class 文件加载到内存时不一定会在内存中保留</li>
<li><code>RUNTIME</code>：一直保留到运行时</li>
</ul>
<p>如果没有声明 <code>@Retention</code>，默认为 <code>CLASS</code>。</p>
<h4 id="元注解-Inherited"><a href="#元注解-Inherited" class="headerlink" title="元注解 @Inherited"></a>元注解 <code>@Inherited</code></h4><p>注解不能相互继承，但子类可以继承父类的注解，只要你在注解里面添加了 <code>@Inherited</code></p>
<h3 id="查看注解信息"><a href="#查看注解信息" class="headerlink" title="查看注解信息"></a>查看注解信息</h3><p><code>Class</code>、<code>Field</code>、<code>Method</code>、<code>Constructor</code> 中都有如下方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取所有的注解</span></span><br><span class="line"><span class="keyword">public</span> Annotation[] getAnnotations()</span><br><span class="line"><span class="comment">// 获取所有本元素上直接声明的注解，忽略 inherited 来的</span></span><br><span class="line"><span class="keyword">public</span> Annotation[] getDeclaredAnnotations()</span><br><span class="line"><span class="comment">// 获取指定类型的注解，没有返回 null</span></span><br><span class="line"><span class="keyword">public</span> &lt;A extends Annotation&gt; <span class="function">A <span class="title">getAnnotation</span><span class="params">(Class&lt;A&gt; annotationClass)</span></span></span><br><span class="line"><span class="function"><span class="comment">// 判断是否有指定类型的注解</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAnnotationPresent</span><span class="params">(Class&lt;? extends Annotation&gt; annotationClass)</span></span></span><br></pre></td></tr></table></figure>

<p>对于 <code>Method</code> 和 <code>Contructor</code>，它们都有方法参数，而参数也可以有注解，所以它们都有如下方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Annotation[][] getParameterAnnotations()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Annotation 是一个接口，它表示注解，具体定义为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Annotation</span> </span>&#123;</span><br><span class="line"> <span class="function"><span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span></span>;</span><br><span class="line"> <span class="function"><span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>;</span><br><span class="line"> <span class="function">String <span class="title">toString</span><span class="params">()</span></span>;</span><br><span class="line"> <span class="comment">// 返回真正的注解类型</span></span><br><span class="line"> Class&lt;? extends Annotation&gt; annotationType();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>实际上，所有的注解类型，内部实现时，都是扩展的 Annotation。</p>
</blockquote>
<h3 id="DI-容器示例"><a href="#DI-容器示例" class="headerlink" title="DI 容器示例"></a>DI 容器示例</h3><h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention</span>(RUNTIME)</span><br><span class="line"><span class="meta">@Target</span>(FIELD)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SimpleInject &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceA</span> </span>&#123;</span><br><span class="line">    <span class="meta">@SimpleInject</span></span><br><span class="line">    ServiceB b;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">callB</span><span class="params">()</span></span>&#123;</span><br><span class="line">        b.action();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceB</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">action</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"I'm B"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ServiceA a = SimpleContainer.getInstance(ServiceA<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">a.callB();</span><br></pre></td></tr></table></figure>

<h4 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">getInstance</span><span class="params">(Class&lt;T&gt; cls)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        T obj = cls.newInstance();</span><br><span class="line">        Field[] fields = cls.getDeclaredFields();</span><br><span class="line">        <span class="keyword">for</span> (Field f : fields) &#123;</span><br><span class="line">            <span class="keyword">if</span> (f.isAnnotationPresent(SimpleInject<span class="class">.<span class="keyword">class</span>)) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (!f.isAccessible()) &#123;</span><br><span class="line">                    f.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                Class&lt;?&gt; fieldCls = f.getType();</span><br><span class="line">                f.set(obj, getInstance(fieldCls));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="代理"><a href="#代理" class="headerlink" title="代理"></a>代理</h2><h3 id="静态代理"><a href="#静态代理" class="headerlink" title="静态代理"></a>静态代理</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleStaticProxyDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">interface</span> <span class="title">IService</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">RealService</span> <span class="keyword">implements</span> <span class="title">IService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"hello"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TraceProxy</span> <span class="keyword">implements</span> <span class="title">IService</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> IService realService;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">TraceProxy</span><span class="params">(IService realService)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.realService = realService;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"entering sayHello"</span>);</span><br><span class="line">            <span class="keyword">this</span>.realService.sayHello();</span><br><span class="line">            System.out.println(<span class="string">"leaving sayHello"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        IService realService = <span class="keyword">new</span> RealService();</span><br><span class="line">        IService proxyService = <span class="keyword">new</span> TraceProxy(realService);</span><br><span class="line">        proxyService.sayHello();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JDK-动态代理"><a href="#JDK-动态代理" class="headerlink" title="JDK 动态代理"></a>JDK 动态代理</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleJDKDynamicProxyDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">interface</span> <span class="title">IService</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">RealService</span> <span class="keyword">implements</span> <span class="title">IService</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"hello"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleInvocationHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Object realObj;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">SimpleInvocationHandler</span><span class="params">(Object realObj)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.realObj = realObj;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="comment">// proxy 是代理，method 是真实对象的方法，args 是真实对象的方法参数</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"entering "</span> + method.getName());</span><br><span class="line">            <span class="comment">// 真实对象的方法.invoke(真实的对象, 真实对象的方法参数)</span></span><br><span class="line">            Object result = method.invoke(realObj, args);</span><br><span class="line">            System.out.println(<span class="string">"leaving "</span> + method.getName());</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        IService realService = <span class="keyword">new</span> RealService();</span><br><span class="line">        <span class="comment">// java.lang.reflect 包中的静态类 Proxy 的 newProxyInstance 方法有三个参数</span></span><br><span class="line">        <span class="comment">// ① 类加载器；②真实对象的所有的接口；③一个 InvocationHandler 接口类型（与 Proxy 同包）</span></span><br><span class="line">        <span class="comment">// InvocationHandler 接口只定义了一个方法 invoke，对代理接口所有方法的调用都会转给该方法</span></span><br><span class="line">        IService proxyService = (IService)Proxy.newProxyInstance(</span><br><span class="line">            IService<span class="class">.<span class="keyword">class</span>.<span class="title">getClassLoader</span>(),</span></span><br><span class="line">            new Class&lt;?&gt;[] &#123; IService.class &#125;, </span><br><span class="line">            <span class="keyword">new</span> SimpleInvocationHandler(realService)</span><br><span class="line">        );</span><br><span class="line">        <span class="comment">// JDK 动态代理原理：</span></span><br><span class="line">        <span class="comment">// ① 获取代理类定义；② 获取代理类构造方法，构造方法有一个 InvocationHandler 类型的参数</span></span><br><span class="line">        <span class="comment">// ③ 创建 InvocationHandler 对象，创建代理类对象</span></span><br><span class="line">        proxyService.sayHello();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 封装的版本</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GeneralProxyDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">interface</span> <span class="title">IServiceA</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceAImpl</span> <span class="keyword">implements</span> <span class="title">IServiceA</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"hello"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">interface</span> <span class="title">IServiceB</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fly</span><span class="params">()</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceBImpl</span> <span class="keyword">implements</span> <span class="title">IServiceB</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fly</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"flying"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleInvocationHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Object realObj;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">SimpleInvocationHandler</span><span class="params">(Object realObj)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.realObj = realObj;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"entering "</span> + realObj.getClass().getSimpleName() + <span class="string">"::"</span> + method.getName());</span><br><span class="line">            Object result = method.invoke(realObj, args);</span><br><span class="line">            System.out.println(<span class="string">"leaving "</span> + realObj.getClass().getSimpleName() + <span class="string">"::"</span> + method.getName());</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">getProxy</span><span class="params">(Class&lt;T&gt; intf, T realObj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (T) Proxy.newProxyInstance(intf.getClassLoader(), <span class="keyword">new</span> Class&lt;?&gt;[] &#123; intf &#125;,</span><br><span class="line">                <span class="keyword">new</span> SimpleInvocationHandler(realObj));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        IServiceA a = <span class="keyword">new</span> ServiceAImpl();</span><br><span class="line">        IServiceA aProxy = getProxy(IServiceA<span class="class">.<span class="keyword">class</span>, <span class="title">a</span>)</span>;</span><br><span class="line">        aProxy.sayHello();</span><br><span class="line"></span><br><span class="line">        IServiceB b = <span class="keyword">new</span> ServiceBImpl();</span><br><span class="line">        IServiceB bProxy = getProxy(IServiceB<span class="class">.<span class="keyword">class</span>, <span class="title">b</span>)</span>;</span><br><span class="line">        bProxy.fly();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="cglib-动态代理"><a href="#cglib-动态代理" class="headerlink" title="cglib 动态代理"></a><code>cglib</code> 动态代理</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleCGLibDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">RealService</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"hello"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleInterceptor</span> <span class="keyword">implements</span> <span class="title">MethodInterceptor</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="comment">// object —— 代理对象</span></span><br><span class="line">        <span class="comment">// method —— 真实对象的方法</span></span><br><span class="line">        <span class="comment">// args —— 真实对象方法的参数</span></span><br><span class="line">        <span class="comment">// proxy —— 代理对象重写父类的同名方法</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Object object, Method method,</span></span></span><br><span class="line"><span class="function"><span class="params">                Object[] args, MethodProxy proxy)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"entering "</span> + method.getName());</span><br><span class="line">            <span class="comment">// 代理对象的方法.invokeSuper(代理对象, 真实对象方法的参数)</span></span><br><span class="line">            Object result = proxy.invokeSuper(object, args);</span><br><span class="line">            System.out.println(<span class="string">"leaving "</span> + method.getName());</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">getProxy</span><span class="params">(Class&lt;T&gt; cls)</span> </span>&#123;</span><br><span class="line">        Enhancer enhancer = <span class="keyword">new</span> Enhancer();</span><br><span class="line">        enhancer.setSuperclass(cls);</span><br><span class="line">        enhancer.setCallback(<span class="keyword">new</span> SimpleInterceptor());</span><br><span class="line">        <span class="keyword">return</span> (T) enhancer.create();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        RealService proxyService = getProxy(RealService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        proxyService.sayHello();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="两种动态代理的区别"><a href="#两种动态代理的区别" class="headerlink" title="两种动态代理的区别"></a>两种动态代理的区别</h3><p>Java SDK 代理面向的是<strong>一组接口</strong>，它为这些接口动态创建了一个实现类，接口的具体实现逻辑是通过自定义的 <code>InvocationHandler</code> 实现的，这个实现是自定义的，也就是说，<strong>其背后都不一定有真正被代理的对象</strong>，也可能多个实际对象，根据情况动态选择。<code>cglib</code> 代理面向的是<strong>一个具体的类</strong>，它动态创建了一个新类，继承了该类，重写了其方法。</p>
<p>从代理的角度看，Java SDK 代理的是对象，需要先有一个实际对象，自定义的 <code>InvocationHandler</code> 引用该对象，然后创建一个代理类和代理对象，客户端访问的是代理对象，代理对象最后再调用实际对象的方法，<code>cglib</code> 代理的是类，创建的对象只有一个。</p>
<p>如果目的都是为一个类的方法增强功能，Java SDK 要求该类必须有接口，且只能处理接口中的方法，<code>cglib</code> 没有这个限制。</p>
<h3 id="AOP-示例"><a href="#AOP-示例" class="headerlink" title="AOP 示例"></a>AOP 示例</h3><h4 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention</span>(RUNTIME)</span><br><span class="line"><span class="meta">@Target</span>(TYPE)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Aspect &#123;</span><br><span class="line">    Class&lt;?&gt;[] value();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span>(&#123;ServiceA<span class="class">.<span class="keyword">class</span>, <span class="title">ServiceB</span>.<span class="title">class</span>&#125;)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">ServiceLogAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">(Object object, Method method, Object[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"entering "</span> + method.getDeclaringClass().getSimpleName()</span><br><span class="line">                + <span class="string">"::"</span> + method.getName() + <span class="string">", args: "</span> + Arrays.toString(args));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">(Object object, Method method, Object[] args, Object result)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"leaving "</span> + method.getDeclaringClass().getSimpleName()</span><br><span class="line">                + <span class="string">"::"</span> + method.getName() + <span class="string">", result: "</span> + result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span>(&#123;ServiceB<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">ExceptionAspect</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">exception</span><span class="params">(Object object,</span></span></span><br><span class="line"><span class="function"><span class="params">            Method method, Object[] args, Throwable e)</span> </span>&#123;</span><br><span class="line">        System.err.println(<span class="string">"exception when calling: "</span> + method.getName()</span><br><span class="line">        + <span class="string">","</span> + Arrays.toString(args));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceA</span> </span>&#123;</span><br><span class="line">    <span class="meta">@SimpleInject</span></span><br><span class="line">    ServiceB b;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">callB</span><span class="params">()</span></span>&#123;</span><br><span class="line">        b.action();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceB</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">action</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"I'm B"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ServiceA a = CGLibContainer.getInstance(ServiceA<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">a.callB();</span><br><span class="line"><span class="comment">/** ::out::</span></span><br><span class="line"><span class="comment"> * entering ServiceA::callB, args: []</span></span><br><span class="line"><span class="comment"> * entering ServiceB::action, args: []</span></span><br><span class="line"><span class="comment"> * I'm B</span></span><br><span class="line"><span class="comment"> * leaving ServiceB::action, result: null</span></span><br><span class="line"><span class="comment"> * leaving ServiceA::callB, result: null</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<h4 id="实现-1"><a href="#实现-1" class="headerlink" title="实现"></a>实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CGLibContainer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> InterceptPoint &#123;</span><br><span class="line">        BEFORE, AFTER, EXCEPTION</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> Class&lt;?&gt;[] aspects = <span class="keyword">new</span> Class&lt;?&gt;[] &#123; ServiceLogAspect<span class="class">.<span class="keyword">class</span>, <span class="title">ExceptionAspect</span>.<span class="title">class</span> &#125;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> Map&lt;Class&lt;?&gt;, Map&lt;InterceptPoint, List&lt;Method&gt;&gt;&gt; interceptMethodsMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Class&lt;?&gt; cls : aspects) &#123;</span><br><span class="line">            Aspect aspect = cls.getAnnotation(Aspect<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">            <span class="keyword">if</span> (aspect != <span class="keyword">null</span>) &#123;</span><br><span class="line">                Method before = getMethod(cls, <span class="string">"before"</span>, </span><br><span class="line">                        new Class&lt;?&gt;[] &#123;Object.class, Method.class, Object[].class&#125;);</span><br><span class="line">                Method after = getMethod(cls, <span class="string">"after"</span>,</span><br><span class="line">                        new Class&lt;?&gt;[] &#123;Object.class, Method.class, Object[].class, Object.class&#125;);</span><br><span class="line">                Method exception = getMethod(cls, <span class="string">"exception"</span>,</span><br><span class="line">                        new Class&lt;?&gt;[] &#123;Object.class, Method.class, Object[].class, Throwable.class&#125;);</span><br><span class="line">                Class&lt;?&gt;[] intercepttedArr = aspect.value();</span><br><span class="line">                <span class="keyword">for</span> (Class&lt;?&gt; interceptted : intercepttedArr) &#123;</span><br><span class="line">                    addInterceptMethod(interceptted, InterceptPoint.BEFORE, before);</span><br><span class="line">                    addInterceptMethod(interceptted, InterceptPoint.AFTER, after);</span><br><span class="line">                    addInterceptMethod(interceptted, InterceptPoint.EXCEPTION, exception);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Method <span class="title">getMethod</span><span class="params">(Class&lt;?&gt; cls, String name, Class&lt;?&gt;[] paramTypes)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> cls.getMethod(name, paramTypes);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addInterceptMethod</span><span class="params">(Class&lt;?&gt; cls, InterceptPoint point, Method method)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (method == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Map&lt;InterceptPoint, List&lt;Method&gt;&gt; map = interceptMethodsMap.get(cls);</span><br><span class="line">        <span class="keyword">if</span> (map == <span class="keyword">null</span>) &#123;</span><br><span class="line">            map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">            interceptMethodsMap.put(cls, map);</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;Method&gt; methods = map.get(point);</span><br><span class="line">        <span class="keyword">if</span> (methods == <span class="keyword">null</span>) &#123;</span><br><span class="line">            methods = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            map.put(point, methods);</span><br><span class="line">        &#125;</span><br><span class="line">        methods.add(method);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> List&lt;Method&gt; <span class="title">getInterceptMethods</span><span class="params">(Class&lt;?&gt; cls, InterceptPoint point)</span> </span>&#123;</span><br><span class="line">        Map&lt;InterceptPoint, List&lt;Method&gt;&gt; map = interceptMethodsMap.get(cls);</span><br><span class="line">        <span class="keyword">if</span> (map == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;Method&gt; methods = map.get(point);</span><br><span class="line">        <span class="keyword">if</span> (methods == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> methods;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AspectInterceptor</span> <span class="keyword">implements</span> <span class="title">MethodInterceptor</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Object object, Method method, Object[] args, MethodProxy proxy)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">            <span class="comment">// 执行 before 方法</span></span><br><span class="line">            List&lt;Method&gt; beforeMethods = getInterceptMethods(object.getClass().getSuperclass(), InterceptPoint.BEFORE);</span><br><span class="line">            <span class="keyword">for</span> (Method m : beforeMethods) &#123;</span><br><span class="line">                m.invoke(<span class="keyword">null</span>, <span class="keyword">new</span> Object[]&#123;object, method, args&#125;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 调用原始方法</span></span><br><span class="line">                Object result = proxy.invokeSuper(object, args);</span><br><span class="line">                <span class="comment">// 执行 after 方法</span></span><br><span class="line">                List&lt;Method&gt; afterMethods = getInterceptMethods(object.getClass().getSuperclass(), InterceptPoint.AFTER);</span><br><span class="line">                <span class="keyword">for</span> (Method m : afterMethods) &#123;</span><br><span class="line">                    m.invoke(<span class="keyword">null</span>, <span class="keyword">new</span> Object[]&#123;object, method, args, result&#125;);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">                <span class="comment">// 执行 exception 方法</span></span><br><span class="line">                List&lt;Method&gt; exceptionMethods = getInterceptMethods(object.getClass().getSuperclass(), InterceptPoint.EXCEPTION);</span><br><span class="line">                <span class="keyword">for</span> (Method m : exceptionMethods) &#123;</span><br><span class="line">                    m.invoke(<span class="keyword">null</span>, <span class="keyword">new</span> Object[]&#123;object, method, args, e&#125;);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">throw</span> e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">createInstance</span><span class="params">(Class&lt;T&gt; cls)</span> <span class="keyword">throws</span> InstantiationException, IllegalAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!interceptMethodsMap.containsKey(cls)) &#123;</span><br><span class="line">            <span class="keyword">return</span> (T) cls.newInstance();</span><br><span class="line">        &#125;</span><br><span class="line">        Enhancer enhancer = <span class="keyword">new</span> Enhancer();</span><br><span class="line">        enhancer.setSuperclass(cls);</span><br><span class="line">        enhancer.setCallback(<span class="keyword">new</span> AspectInterceptor());</span><br><span class="line">        <span class="keyword">return</span> (T) enhancer.create();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">getInstance</span><span class="params">(Class&lt;T&gt; cls)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            T obj = createInstance(cls);</span><br><span class="line">            Field[] fields = cls.getDeclaredFields();</span><br><span class="line">            <span class="keyword">for</span> (Field f : fields) &#123;</span><br><span class="line">                <span class="keyword">if</span> (f.isAnnotationPresent(SimpleInject<span class="class">.<span class="keyword">class</span>)) </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (!f.isAccessible()) &#123;</span><br><span class="line">                        f.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    Class&lt;?&gt; fieldCls = f.getType();</span><br><span class="line">                    f.set(obj, getInstance(fieldCls));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> obj;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="类加载机制"><a href="#类加载机制" class="headerlink" title="类加载机制"></a>类加载机制</h2><h3 id="类加载过程"><a href="#类加载过程" class="headerlink" title="类加载过程"></a>类加载过程</h3><ol>
<li><strong>启动类加载器 (<code>Bootstrap ClassLoader</code>)</strong>：这个加载器是 Java 虚拟机实现的一部分，它负责加载 Java 的基础类，主要是 <code>&lt;JAVA_HOME&gt;/lib/rt.jar</code>，<strong>不是 Java 语言实现的</strong>，一般是 C++ 实现的，我们日常用的 Java 类库比如 <code>String</code>、<code>ArrayList</code> 等都位于该包内；</li>
<li><strong>扩展类加载器 (<code>Extension ClassLoader</code>)</strong>：它负责加载 Java 的一些扩展类，一般是 <code>&lt;JAVA_HOME&gt;/lib/ext</code> 目录中的 jar 包，实现类是 <code>sun.misc.Launcher$ExtClassLoader</code>；</li>
<li><strong>应用程序类加载器 (<code>Application ClassLoader</code>)</strong>：它负责加载应用程序的类，包括自己写的和引入的第三方法类库，即所有在类路径中指定的类，实现类是 <code>sun.misc.Launcher$AppClassLoader</code>。</li>
</ol>
<p>这三个类加载器可以认为是父子委派关系，子 <code>ClassLoader</code> 有一个变量 <code>parent</code> 指向父 <code>ClassLoader</code>，在子 <code>ClassLoader</code> 加载类时，一般会首先通过父 <code>ClassLoader</code> 加载，具体来说，在加载一个类时，基本过程是：</p>
<ol>
<li>判断是否已经加载过了，加载过了，直接返回 Class 对象，一个类只会被一个 <code>ClassLoader</code> 加载一次；</li>
<li>如果没有被加载，先让父 <code>ClassLoader</code> 去加载，如果加载成功，返回得到的 Class 对象；</li>
<li>在父 <code>ClassLoader</code> 没有加载成功的前提下，自己尝试加载类。</li>
</ol>
<p>这就是<strong>双亲委派模型</strong>，不过也有很多类加载实际上不遵守这个模型。如 <code>OSGI</code> 的网状加载，<code>JNDI</code> 的父加载器委派给子加载器加载…</p>
<h3 id="理解-ClassLoader"><a href="#理解-ClassLoader" class="headerlink" title="理解 ClassLoader"></a>理解 <code>ClassLoader</code></h3><h4 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ClassLoader <span class="title">getClassLoader</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> ClassLoader <span class="title">getParent</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ClassLoader <span class="title">getSystemClassLoader</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Class&lt;?&gt; <span class="title">loadClass</span><span class="params">(String name)</span> <span class="keyword">throws</span> ClassNotFoundException</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ClassLoader cl = ClassLoader.getSystemClassLoader();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    Class&lt;?&gt; cls = cl.loadClass(<span class="string">"java.util.ArrayList"</span>);</span><br><span class="line">    ClassLoader actualLoader = cls.getClassLoader();</span><br><span class="line">    <span class="comment">// 由于委派机制，Class 的 getClassLoader() 方法返回的不一定是调用 loadClass 的 ClassLoader</span></span><br><span class="line">    System.out.println(actualLoader);</span><br><span class="line">&#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="classLoader-loadClass-和-Class-forName"><a href="#classLoader-loadClass-和-Class-forName" class="headerlink" title="classLoader.loadClass 和 Class.forName"></a><code>classLoader.loadClass</code> 和 <code>Class.forName</code></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Class&lt;?&gt; forName(String className)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Class&lt;?&gt; forName(String name, <span class="keyword">boolean</span> initialize, ClassLoader loader)</span><br></pre></td></tr></table></figure>

<p><code>ClassLoader</code> 的 <code>loadClass</code> 不会执行类的初始化代码，而 <code>Class</code> 的 <code>forName</code> 是会执行类的初始化代码的</p>
<p>可以通过 <code>ClassLoader</code> 的 <code>loadClass</code> 或 <code>Class.forName</code> 自己加载类，很多应用使用面向接口的编程，接口具体的实现类可能有很多，适用于不同的场合，具体使用哪个实现类在配置文件中配置，通过更改配置，不用改变代码，就可以改变程序的行为，这是策略模式。</p>
<h3 id="自定义-ClassLoader"><a href="#自定义-ClassLoader" class="headerlink" title="自定义 ClassLoader"></a>自定义 <code>ClassLoader</code></h3><h4 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 继承类 ClassLoader，重写 findClass</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClassLoader</span> <span class="keyword">extends</span> <span class="title">ClassLoader</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String BASE_DIR = <span class="string">"data/c87/"</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        <span class="comment">// 使用自己的逻辑寻找 class 文件字节码的字节形式，找到后，使用 defineClass 转换为 Class 对象</span></span><br><span class="line">        String fileName = name.replaceAll(<span class="string">"\\."</span>, <span class="string">"/"</span>);</span><br><span class="line">        fileName = BASE_DIR + fileName + <span class="string">".class"</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">byte</span>[] bytes = BinaryFileUtils.readFileToByteArray(fileName);</span><br><span class="line">            <span class="keyword">return</span> defineClass(name, bytes, <span class="number">0</span>, bytes.length);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ClassNotFoundException(<span class="string">"failed to load class "</span> + name, ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MyClassLoader cl1 = <span class="keyword">new</span> MyClassLoader();</span><br><span class="line">String className = <span class="string">"shuo.laoma.dynamic.c87.HelloService"</span>;</span><br><span class="line">Class&lt;?&gt; class1 = cl1.loadClass(className);</span><br><span class="line"></span><br><span class="line">MyClassLoader cl2 = <span class="keyword">new</span> MyClassLoader();</span><br><span class="line">Class&lt;?&gt; class2 = cl2.loadClass(className);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (class1 != class2) &#123;</span><br><span class="line">    System.out.println(<span class="string">"different classes"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="意义"><a href="#意义" class="headerlink" title="意义"></a>意义</h4><ul>
<li>热部署<br>使用同一个 <code>ClassLoader</code>，类只会被加载一次，加载后，即使 class 文件已经变了，再次加载，得到的也还是原来的 Class 对象，而创建一个新的 <code>ClassLoader</code>，再用它加载 Class，得到的 Class 对象就是新的，从而实现动态更新。<br>具体实现思路：① 一个线程监测类文件变化；② 发现文件变化就用新的 <code>ClassLoader</code> 加载类并替换 JVM 中原来的类。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">monitor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Thread t = <span class="keyword">new</span> Thread() &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">long</span> lastModified = <span class="keyword">new</span> File(FILE_NAME).lastModified();</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                    <span class="keyword">long</span> now = <span class="keyword">new</span> File(FILE_NAME).lastModified();</span><br><span class="line">                    <span class="keyword">if</span> (now != lastModified) &#123;</span><br><span class="line">                        lastModified = now;</span><br><span class="line">                        reloadHelloService();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    t.start();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">reloadHelloService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    helloService = createHelloService();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> IHelloService <span class="title">createHelloService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        MyClassLoader cl = <span class="keyword">new</span> MyClassLoader();</span><br><span class="line">        Class&lt;?&gt; cls = cl.loadClass(CLASS_NAME);</span><br><span class="line">        <span class="keyword">if</span> (cls != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (IHelloService) cls.newInstance();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>应用的模块化和相互隔离<br>一个复杂的程序，内部可能按模块组织，不同模块可能使用同一个类，但使用的是不同版本，如果使用同一个类加载器，它们是无法共存的，不同模块使用不同的类加载器就可以实现隔离：Tomcat 使用它隔离不同的 Web 应用，OSGI 使用它隔离不同模块。</li>
<li>从不同地方灵活加载<br>比如 JNDI 之类的地方。</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Java-%E7%BC%96%E7%A8%8B%E7%9A%84%E9%80%BB%E8%BE%91/" rel="tag"># Java 编程的逻辑</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/01/17/Java-%E9%9B%86%E5%90%88%E7%BB%BC%E8%BF%B0/" rel="prev" title="Java 集合综述">
      <i class="fa fa-chevron-left"></i> Java 集合综述
    </a></div>
      <div class="post-nav-item">
    <a href="/2019/01/23/Java-8-%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" rel="next" title="Java 8 函数式编程">
      Java 8 函数式编程 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#反射"><span class="nav-text">反射</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#获取类对象"><span class="nav-text">获取类对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取类名称信息"><span class="nav-text">获取类名称信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取字段信息"><span class="nav-text">获取字段信息</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Class-的方法"><span class="nav-text">Class 的方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Field-的方法"><span class="nav-text">Field 的方法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获得方法信息"><span class="nav-text">获得方法信息</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Class-的方法-1"><span class="nav-text">Class 的方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Method-的方法"><span class="nav-text">Method 的方法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建对象"><span class="nav-text">创建对象</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Class-的方法-2"><span class="nav-text">Class 的方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Constructor-的方法"><span class="nav-text">Constructor 的方法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#类型检查和转换"><span class="nav-text">类型检查和转换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取-Class-的类型信息"><span class="nav-text">获取 Class 的类型信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取-Class-的声明信息"><span class="nav-text">获取 Class 的声明信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#内部类"><span class="nav-text">内部类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#类类型的加载"><span class="nav-text">类类型的加载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#反射和数组"><span class="nav-text">反射和数组</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Class-的方法-3"><span class="nav-text">Class 的方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Array-的方法"><span class="nav-text">Array 的方法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#反射和枚举"><span class="nav-text">反射和枚举</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#反射和泛型"><span class="nav-text">反射和泛型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Class-的方法-4"><span class="nav-text">Class 的方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Field-的方法-1"><span class="nav-text">Field 的方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Method-的方法-1"><span class="nav-text">Method 的方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Constructor-的方法-1"><span class="nav-text">Constructor 的方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Type-接口"><span class="nav-text">Type 接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#示例"><span class="nav-text">示例</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#注解"><span class="nav-text">注解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建注解"><span class="nav-text">创建注解</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#元注解-Target"><span class="nav-text">元注解 @Target</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#元注解-Retention"><span class="nav-text">元注解 @Retention</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#元注解-Inherited"><span class="nav-text">元注解 @Inherited</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看注解信息"><span class="nav-text">查看注解信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DI-容器示例"><span class="nav-text">DI 容器示例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#使用"><span class="nav-text">使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#实现"><span class="nav-text">实现</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#代理"><span class="nav-text">代理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#静态代理"><span class="nav-text">静态代理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JDK-动态代理"><span class="nav-text">JDK 动态代理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cglib-动态代理"><span class="nav-text">cglib 动态代理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#两种动态代理的区别"><span class="nav-text">两种动态代理的区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AOP-示例"><span class="nav-text">AOP 示例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#使用-1"><span class="nav-text">使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#实现-1"><span class="nav-text">实现</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#类加载机制"><span class="nav-text">类加载机制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#类加载过程"><span class="nav-text">类加载过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#理解-ClassLoader"><span class="nav-text">理解 ClassLoader</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#基本用法"><span class="nav-text">基本用法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#classLoader-loadClass-和-Class-forName"><span class="nav-text">classLoader.loadClass 和 Class.forName</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义-ClassLoader"><span class="nav-text">自定义 ClassLoader</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤"><span class="nav-text">步骤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#示例-1"><span class="nav-text">示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#意义"><span class="nav-text">意义</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="xijinian"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">xijinian</p>
  <div class="site-description" itemprop="description">放轻松，就像在漫游地球～</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">124</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">29</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://twitter.com/xijinian" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;xijinian" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="http://weibo.com/xijinian" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;xijinian" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i></a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2015 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xijinian</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.1.0/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://xijinian.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "https://www.xijinian.top/2019/01/20/%E5%8F%8D%E5%B0%84%E3%80%81%E6%B3%A8%E8%A7%A3%E3%80%81%E4%BB%A3%E7%90%86%E5%92%8C%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/";
    this.page.identifier = "2019/01/20/反射、注解、代理和类加载机制/";
    this.page.title = "反射、注解、代理和类加载机制";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://xijinian.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

</body>
</html>
